# ChemStructVal Performance Benchmark Results

## Environment

- **Python Version:** 3.11+
- **RDKit Version:** 2024.3.0
- **Platform:** macOS (Darwin 25.2.0)
- **Date:** 2026-01-23
- **Iterations per molecule:** 5 (final benchmark)

## Test Set

13 diverse molecules covering:
- Simple drug-like (aspirin, caffeine, ibuprofen)
- Complex drug-like (atorvastatin, ritonavir)
- Natural products (quercetin, resveratrol)
- Challenging structures (metal complexes, stereochemistry, macrocycles)
- Edge cases (single atom, small fragments, heterocycles)

## Performance Targets

| Metric | Target | Actual | Status |
|--------|--------|--------|--------|
| Single molecule p95 | < 3000 ms | 28.28 ms | PASS |
| Throughput | > 1 mol/sec | 69.4 mol/sec | PASS |
| Cached validation | < 50 ms | < 5 ms | PASS |

## Aggregate Timing (Final Benchmark)

| Metric | Value |
|--------|-------|
| Mean | 14.42 ms |
| Median | 12.88 ms |
| Min | 7.40 ms |
| Max | 28.28 ms |
| StdDev | 5.92 ms |

## Timing by Stage

| Stage | Mean (ms) | % of Total |
|-------|-----------|------------|
| Parse | 0.10 | 0.7% |
| Validation | 1.98 | 13.7% |
| Alerts | 1.94 | 13.5% |
| ML Scoring | 5.02 | 34.8% |
| Standardization | 5.38 | 37.3% |

## Per-Molecule Results

| Molecule | Total (ms) | Parse | Validation | Alerts |
|----------|------------|-------|------------|--------|
| small_fragment | 7.40 | 0.02 | 1.24 | 1.23 |
| aromatic_heterocycle | 9.19 | 0.06 | 1.43 | 1.29 |
| stereochemistry | 9.52 | 0.05 | 1.52 | 1.35 |
| macrocycle | 11.35 | 0.08 | 1.60 | 1.53 |
| aspirin | 11.63 | 0.08 | 1.80 | 1.70 |
| caffeine | 11.78 | 0.09 | 1.74 | 1.69 |
| ibuprofen | 12.88 | 0.09 | 2.12 | 1.91 |
| single_atom | 13.28 | 0.02 | 1.19 | 1.17 |
| resveratrol | 13.86 | 0.13 | 2.11 | 2.12 |
| quercetin | 17.33 | 0.14 | 2.20 | 2.97 |
| metal_complex | 17.45 | 0.08 | 1.99 | 1.57 |
| atorvastatin | 23.48 | 0.21 | 3.26 | 3.47 |
| ritonavir | 28.28 | 0.22 | 3.55 | 3.26 |

## Bottlenecks Identified

1. **Standardization (37.3%)** - ChEMBL structure pipeline is the largest contributor
2. **ML Scoring (34.8%)** - Descriptor calculation across 217 RDKit descriptors
3. **Complex molecules** - atorvastatin and ritonavir take 2x longer than simple molecules

## Optimizations Applied

### 1. Redis Caching (Plan 04-01, Task 2)

- **What:** InChIKey-based caching for validation results
- **Impact:** Repeated validation < 5ms (cache hit bypasses all computation)
- **Cache TTL:** 1 hour (configurable via VALIDATION_CACHE_TTL)
- **Key format:** `validation:{inchikey}:{checks_hash}`

### 2. SMARTS Precompilation (Verified)

- **What:** Filter catalogs use @lru_cache for singleton behavior
- **Status:** Verified working in filter_catalog.py
- **Impact:** First call ~11ms to compile, subsequent calls ~0ms
- **Speedup:** 10,000x+ for cached catalog access
- **Cache info:** maxsize=8, sufficient for all catalog types

```python
# Verification output:
# First call (compile): 11.31ms
# Second call (cached): 0.00ms
# Speedup: 10051.5x
# Same instance: True
# Cache info: CacheInfo(hits=1, misses=1, maxsize=8, currsize=1)
```

## Cache Performance

| Metric | Value |
|--------|-------|
| Cache hit latency | < 5 ms (Redis network + JSON deserialize) |
| Cache miss latency | 14.42 ms (validation) + ~1 ms (cache write) |
| Cache hit rate (repeated) | 100% (deterministic for same molecule+checks) |
| SMARTS cache speedup | 10,000x+ |

## Throughput Analysis

- **Base throughput:** 69.4 molecules/second
- **With cache hits:** > 200 molecules/second (estimated)
- **Target (1 mol/sec):** Exceeded by 69x

## Recommendations

1. **Pre-warm SMARTS catalogs** - Call `get_filter_catalog()` for common catalogs on startup
2. **Monitor cache metrics** - Track hits vs misses in production
3. **Consider descriptor subset** - If ML scoring bottleneck grows, use subset of descriptors
4. **Async standardization** - For batch processing, consider parallel ChEMBL pipeline calls

## Conclusion

All performance targets met or exceeded:
- P95 validation time: 28.28 ms (target: < 3000 ms) - 106x better than target
- Throughput: 69.4 mol/sec (target: > 1 mol/sec) - 69x better than target
- Cached validation: < 5 ms (target: < 50 ms) - 10x better than target

The validation pipeline is optimized for production use with:
- InChIKey-based Redis caching for repeated molecule validation
- lru_cache-based SMARTS precompilation for filter catalogs
- Graceful handling of invalid molecules (no cache pollution)

---

*Benchmark results generated by `profile_validation.py`*
*Last updated: 2026-01-23*
