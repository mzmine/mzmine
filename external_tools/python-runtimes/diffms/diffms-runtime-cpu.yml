name: mzmine-diffms

# CPU runtime for DiffMS used by MZmine.
#
# Notes:
# - Keep this environment cross-platform (macOS, Linux, Windows).
# - This is intended to be packed via conda-pack and bundled with MZmine.
# - DiffMS upstream was tested with Python 3.9, torch 2.3.1, and torch_geometric 2.3.1.
#   (see external_tools/diffms/vendor/DiffMS/README.md)
# - Our runner (external_tools/diffms/src/mzmine_diffms_predict.py) requires torch, rdkit, torch_geometric,
#   omegaconf/hydra, pytorch-lightning, torchmetrics, etc.
#
# Channels:
# - conda-forge: rdkit, scientific stack
# - pytorch: pytorch builds (CPU default on most platforms if pytorch-cuda is not requested)
channels:
  - conda-forge
  - pytorch

dependencies:
  # match DiffMS upstream constraints for maximum compatibility
  - python=3.9
  - pip

  # core scientific stack
  - numpy<2
  - scipy
  - pandas
  - networkx
  - tqdm
  - joblib

  # DiffMS + runner dependencies
  - rdkit=2024.09.4
  - omegaconf=2.3.*
  - hydra-core=1.3.*
  - pytorch-lightning=2.0.*
  - torchmetrics=0.11.*
  - wandb
  - h5py
  - matplotlib

  # PyTorch + PyTorch Geometric (torch_geometric import)
  - pytorch=2.3.1
  # NOTE: torch_geometric and its optional compiled dependencies are installed via pip in
  # external_tools/python-runtimes/diffms/build_runtime_packs.* to avoid fragile conda solves across
  # platforms (especially macOS arm64).

  # If you need pip-only packages, add them here:
  # - pip:
  #   - myopic-mces

