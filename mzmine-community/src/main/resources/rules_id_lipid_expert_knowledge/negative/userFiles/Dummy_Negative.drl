//Dummy example for positive polarity rule file

package rules_id_lipid_expert_knowledge.negative.userFiles;

import io.github.mzmine.modules.dataprocessing.id_lipidid_expertknowledge.utils.lipids.FoundLipid;
import io.github.mzmine.modules.dataprocessing.id_lipidid_expertknowledge.utils.adducts.FoundAdduct;
import io.github.mzmine.modules.dataprocessing.id_lipidid_expertknowledge.utils.params.MobilePhases;
import io.github.mzmine.modules.dataprocessing.id_lipidid_expertknowledge.utils.adducts.CommonAdductNegative;
import java.util.List;

// Global variables
global FoundLipid lipid;
global List mobilePhases;

// =======================================
// RULE TYPE 1: Positive presence
// Check that specific adducts appear
// =======================================
rule "Presence [M-H]-"
when
    $adduct: FoundAdduct(adductName == "[M-H]-")
then
    lipid.setScore(1);
    lipid.setDescrCorrect("Contains [M-H]-, ");
    lipid.setAppliedPresence(lipid.getAppliedPresence() + 1);
end

rule "Presence [M+CH3COO]-"
when
    $adduct: FoundAdduct(adductName == "[M+CH3COO]-")
    $phase1 : MobilePhases() from mobilePhases
    eval($phase1 == MobilePhases.CH3COO)
then
    lipid.setScore(1);
    lipid.setDescrCorrect("Contains [M+CH3COO]-, ");
    lipid.setAppliedPresence(lipid.getAppliedPresence() + 1);
end

// =======================================
// RULE TYPE 2: Negative presence (absence)
// Check if most intense adduct does NOT appear
// =======================================
rule "No presence [M+CH3COO]-"
when
    not FoundAdduct(adductName == "[M+CH3COO]-")
    $phase1 : MobilePhases() from mobilePhases
    eval($phase1 == MobilePhases.CH3COO)
then
    lipid.setScore(-1);
    lipid.setDescrIncorrect("Missing [M+CH3COO]-, ");
    List<FoundAdduct> adducts = lipid.getListAdducts();
    lipid.setAppliedPresence(lipid.getAppliedPresence() + 1);
end

// =======================================
// RULE TYPE 3: Correct intensity order
// Adduct1 intensity > Adduct2 intensity
// =======================================
rule "Intensity [M+CH3COO]- > [M-H]-"
when
    $adduct1: FoundAdduct(adductName == "[M+CH3COO]-")
    $adduct2: FoundAdduct(adductName == "[M-H]-")
    $phase1 : MobilePhases() from mobilePhases
    eval($phase1 == MobilePhases.CH3COO)
    eval($adduct1.getIntensity() > $adduct2.getIntensity())
then

    lipid.setScore(2);
    lipid.setDescrCorrect("Intensity OK [M+CH3COO]- > [M-H]-, ");
    lipid.setAppliedIntensity(lipid.getAppliedIntensity() + 1);
end

// =======================================
// RULE TYPE 4: Incorrect intensity order
// Adduct1 intensity < Adduct2 intensity
// =======================================
rule "Intensity [M+CH3COO]- < [M-H]-"
when
    $adduct1: FoundAdduct(adductName == "[M+CH3COO]-")
    $adduct2: FoundAdduct(adductName == "[M-H]-")
    $phase1 : MobilePhases() from mobilePhases
    eval($phase1 == MobilePhases.CH3COO)
    eval($adduct1.getIntensity() < $adduct2.getIntensity())
then
    lipid.setScore(-2);
    lipid.setDescrIncorrect("Intensity NOT OK [M+CH3COO]- < [M-H]-, ");
    lipid.setAppliedIntensity(lipid.getAppliedIntensity() + 1);
end